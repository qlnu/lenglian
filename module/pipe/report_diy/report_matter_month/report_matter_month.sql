sql.pipe.report_diy.report_matter_month.select =  1,2,1,2,1,2,1,2,1,2,3,3,3,3,3,1,2,1,1,2,3,3,3,3,3,2,1,1,2,1,2,1,2,1,2,1,2,3,3,3,3,3,1,2,1>pipe.report_diy.report_matter_month.select
sql.pipe.report_diy.report_matter_month.select = main,select  to_char(axiom_utc_to_date(?), 'yyyy-mm-dd') as s_date, to_char(axiom_utc_to_date(?), 'yyyy-mm-dd') as e_date,  attt.target_name,  attt.target_id,  nvl(atptt.patrol_count,0) patrol_count,  nvl(aastt.speed_count,0) speed_count,  nvl(aartt.region_count,0) region_count, nvl(aaptt.point_count,0) point_count,  nvl(task.task_count,0) task_count,  trunc(salaryt.day_pass * patt.month_salary / 30,2) as money, trunc(salaryt.rate_pass,4) as rate_pass ,aaptt.prize_count as prize_count from  (select pat.target_id ,  pat.month_salary from pipe_attendant pat) patt,  (select count(*) as patrol_count,  atpt.target_id from axiom_track_patrol atpt  where atpt.gps_time between ? and ? group by atpt.target_id) atptt,  (select count(*) as speed_count, aast.target_id  from axiom_alarm_speed aast where aast.gps_time between ? and ?  group by aast.target_id) aastt,   (select count(*) as region_count, aart.target_id  from axiom_alarm_region aart where aart.gps_time between ? and ?  group by aart.target_id) aartt,  (select  target_id , sum(leak_piont_count) as point_count, decode(sign(sum(prize_count) - 2 ), -1 ,0,1) as prize_count  from( select  base.target_id, nvl(t_point_count - piont_count, t_point_count) as leak_piont_count, decode(sign(nvl(t_point_count - piont_count, t_point_count) - 2 ), -1 ,0,nvl(t_point_count - piont_count, t_point_count)) as prize_count  from  ( select target_id, gps_date,count(gps_date) as piont_count from( select target_id,to_char(trunc(axiom_utc_to_date(gps_time)), 'yyyy-mm-dd') as gps_date, point_id from axiom_alarm_point where gps_time  between ? and ?  group by target_id,trunc(axiom_utc_to_date(gps_time)),point_id ) group by target_id,gps_date ) point, (select target_id, gps_date from (select substr(?, s, e - s) target_id from (select pos_start.pos as s, pos_end.pos as e from (select rownum rn, pos from (select distinct pos from (select instr(concat(',', ?), ',',  rownum) as pos from dual connect by rownum <= length(?)) where pos > 0 order by pos)) pos_start,  (select rownum rn, pos from (select distinct pos from (select instr(concat(?, ','), ',', rownum) as pos from dual connect by rownum <= length(?)) where pos > 0 order by pos)) pos_end where pos_start.rn = pos_end.rn)) target_base,  (select to_char(axiom_utc_to_date((trunc(? / (24 * 60 * 60)) + rownum ) * (24 * 60 * 60)), 'yyyy-mm-dd') as gps_date from dual connect by rownum <= (trunc((? - ?) / (24 * 60 * 60)) + 1)) date_base) base ,  (select count(point_id)as t_point_count,target_id from axiom_analyze_target_point group by target_id ) target_point  where base.gps_date = point.gps_date(+) and base.target_id = point.target_id(+)  and base.target_id = target_point.target_id(+) ) group by target_id ) aaptt , (select target_id, count(task_date) as task_count from pipe_special_task where task_date between ? and ? group by target_id,trunc(axiom_utc_to_date(task_date)) ) task, (select att.target_id, att.target_name  from axiom_target att  where att.target_id in (select substr(?, s, e - s)  from (select pos_start.pos as s, pos_end.pos as e from  (select rownum rn, pos from (select distinct pos from  (select instr(concat(',', ?),',', rownum) as pos from dual  connect by rownum <= length(?))  where pos > 0  order by pos)) pos_start, (select rownum rn, pos from (select distinct pos  from (select instr(concat(?, ','), ',',  rownum) as pos from dual  connect by rownum <= length(?)) where pos > 0 order by pos)) pos_end  where pos_start.rn = pos_end.rn))) attt,  (select target_id,  count(*)  as day_pass,count(*)/(trunc((? - ?) / (24 * 60 * 60)) + 1) as rate_pass   from (select gps_date, target_id, leak_piont_count, task_count, sign(sign(leak_piont_count * 2 - 1) + sign(task_count) * -2) total_pass from( select base.gps_date, base.target_id, nvl(piont_count, 0) piont_count, nvl(task_count, 0) task_count, nvl(t_point_count, 0) t_point_count , nvl(t_point_count - piont_count, t_point_count) leak_piont_count from  (select target_id, to_char(trunc(axiom_utc_to_date(gps_time)), 'yyyy-mm-dd') as gps_date,  count(*) as patrol_count from axiom_track_patrol where bitand(terminal_status, 16) = 16 and gps_time between ? and ? group by target_id, trunc(axiom_utc_to_date(gps_time))) patrol,  (select target_id, to_char(trunc(axiom_utc_to_date(gps_time)), 'yyyy-mm-dd') as gps_date, count(gps_time) as speed_count from axiom_alarm_speed where gps_time between ? and ? group by target_id,trunc(axiom_utc_to_date(gps_time))) speed,  (select target_id,to_char(trunc(axiom_utc_to_date(gps_time)), 'yyyy-mm-dd') as gps_date, count(gps_time) as region_count from axiom_alarm_region where gps_time between ? and ? group by target_id,trunc(axiom_utc_to_date(gps_time))) region, ( select target_id, gps_date,count(gps_date) as piont_count from( select target_id,to_char(trunc(axiom_utc_to_date(gps_time)), 'yyyy-mm-dd') as gps_date, point_id from axiom_alarm_point where gps_time  between ? and ?  group by target_id,trunc(axiom_utc_to_date(gps_time)),point_id ) group by target_id,gps_date ) point, (select target_id,to_char(trunc(axiom_utc_to_date(task_date)), 'yyyy-mm-dd') as task_date, count(task_date) as task_count from pipe_special_task where task_date between ? and ? group by target_id,trunc(axiom_utc_to_date(task_date)) ) task, (select target_id, gps_date from (select substr(?, s, e - s) target_id from (select pos_start.pos as s, pos_end.pos as e from (select rownum rn, pos from (select distinct pos from (select instr(concat(',', ?), ',',  rownum) as pos from dual connect by rownum <= length(?)) where pos > 0 order by pos)) pos_start,  (select rownum rn, pos from (select distinct pos from (select instr(concat(?, ','), ',', rownum) as pos from dual connect by rownum <= length(?)) where pos > 0 order by pos)) pos_end where pos_start.rn = pos_end.rn)) target_base,  (select to_char(axiom_utc_to_date((trunc(? / (24 * 60 * 60)) + rownum ) * (24 * 60 * 60)), 'yyyy-mm-dd') as gps_date from dual connect by rownum <= (trunc((? - ?) / (24 * 60 * 60)) + 1)) date_base) base , (select count(point_id)as t_point_count,target_id from axiom_analyze_target_point group by target_id ) target_point where base.gps_date = patrol.gps_date(+)  and base.gps_date = speed.gps_date(+)  and base.gps_date = region.gps_date(+)  and base.gps_date = point.gps_date(+)   and base.gps_date = task.task_date(+)   and base.target_id = patrol.target_id(+)  and base.target_id = speed.target_id(+)  and base.target_id = region.target_id(+)  and base.target_id = point.target_id(+)   and base.target_id = task.target_id(+)  and base.target_id = target_point.target_id(+)  ) order by target_id, gps_date )  vtable  where vtable.total_pass = -1 group by target_id  ) salaryt  where attt.target_id = patt.target_id(+)  and attt.target_id = atptt.target_id(+)  and attt.target_id = aastt.target_id(+)  and attt.target_id = aartt.target_id(+)  and attt.target_id = aaptt.target_id(+)  and attt.target_id = salaryt.target_id(+)  and attt.target_id = task.target_id(+)  order by  attt.target_name
 

http.report
report.pipe.report_diy.report_matter_month.select.head =  集体报表(奖金),开始日期 ,结束日期 ,巡线员 ,事件上报, 超速报警 ,越界报警, 巡漏报警, 特殊任务 ,合格率(%) ,实发工资, 奖金 
report.pipe.report_diy.report_matter_month.select.sql =  main,select * from table(axiom_report_matter_manth(?,?,?))
